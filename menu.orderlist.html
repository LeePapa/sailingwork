
<!-- --------------------我的订单-------------------- -->
<script type="text/javascript">
$(function() {
    var OrderList = new function(){
        var THIS = this;
        var $doing = $("#id_myorder_1494663243 .ctrl .doing");
        var box = new $.FloatBox($("#id_myorder_1494663243"));

        console.log("OrderList");

        function Open()
        {
            box.Open();
            ReLoad();
        }
        THIS.Open = Open;

        function CreateList(list)
        {
            if(!list)
            {
                return;
            }
            var data = {
                list : []
            }
            for(var i in list)
            {
                var item = list[i];
                item.dine_way = DineWay.toString(item.dine_way);
                item.pay_way = PayWay.toString(item.pay_way);
                item.order_status = OrderStatus.toString(item.order_status);
                item.order_time_txt = Util.TimeTo(item.order_time, "MM-dd hh:mm");
                data.list.push(item);
            }
            var html = template('tp_myorder_list', data);
            $("#tp_myorder_list").prevAll(".line").remove();
            var $ary = $(html).insertBefore("#tp_myorder_list");
            $ary.click(function(){
                var order_id = $(this).find(".order_id").text();
                OpenOrder(order_id);
            })
        }

        function ReLoad()
        {
            $doing.html("正在加载数据...").show().SetPromptStyle();

            Util.EncSubmit("order_get.php",
                {
                    orderlist   : true,
                    customer_id : window.CustomerInfo.CustomerId()
                },
                function(resp){
                    if(resp.ret < 0)
                    {
                        $doing.html(errcode.toString(resp.ret)).show().SetErrStyle();
                        return;
                    }
                    SetUi(resp.data);
                    $doing.html("");
                    box.Open();
                }
            );

            function SetUi(data)
            {
                CreateList(data.list);
            }
        }

        function OpenOrder(order_id)
        {
            $doing.html("正在加载数据...").show().SetPromptStyle();

            Util.EncSubmit("order_get.php",
                {
                    orderinfo : true,
                    order_id  : order_id
                },
                function(resp){
                    if(resp.ret < 0)
                    {
                        $doing.html(errcode.toString(resp.ret)).show().SetErrStyle();
                        return;
                    }
                    SetUi(resp.data);
                    $doing.html("");
                }
            );

            function SetUi(data)
            {
                window.OpenOrderDetail(data.info);
                return;
            }
        }

        function Init()
        {
            // ReLoad();
        }

        $("#id_myorder_1494663243 .ctrl .close").click(function(){
            box.Close();
        })

        Init();
    }//end of var OrderList = new function(...
    window.OrderList = OrderList;
});
</script>
<style type="text/css">
#id_myorder_1494663243 {
    display: none;
    background-color: white;
    padding: 0.2rem;
    width: 90%;
    font-size: 1.4rem;
}
#id_myorder_1494663243 table {
    background-color: #e7e7eb
}
#id_myorder_1494663243 th {
    /*background-color: #e7e7eb;*/
}

#id_myorder_1494663243 td {
    background-color: white;
    padding: 0.2rem;
}
#id_myorder_1494663243 .table {
    overflow-y: auto;
    max-height: 30rem;
    border: 0.01rem solid #BBBBBB;
}
#id_myorder_1494663243 .ctrl {
    text-align: right;
    margin: 0.6rem 1rem 0.3rem 0;
}
#id_myorder_1494663243 .customer_num,
#id_myorder_1494663243 .dine_way {
    display: none;
}
</style>
<div id="id_myorder_1494663243">

<fieldset>
<legend>我的订单</legend>
<div class="table">
<table class="table_hover table_head" border="0" width="100%">
    <tr class="list_head">
        <th class="order_id">单号</th>
        <th class="order_time">下单<br/>时间</th>
        <th class="customer_num">人数</th>
        <th class="dine_way">用餐<br/>方式</th>
        <th class="pay_way">支付<br/>方式</th>
        <th class="order_status">状态</th>
    </tr>
    <!-- 模板 -->
    <script id="tp_myorder_list" type="text/html">
    {{each list as item i}}
        <tr class="line hand" align="center">
            <td class="order_id hand">{{item.order_id}}</td>
            <td class="order_time">{{item.order_time_txt}}</td>
            <td class="customer_num">{{item.customer_num}}</td>
            <td class="dine_way">{{item.dine_way}}</td>
            <td class="pay_way">{{item.pay_way}}</td>
            <td class="order_status">{{item.order_status}}</td>
        </tr>
    {{/each}}
    </script>
</table>
</div>

<div class="ctrl">
    <span class="doing align_left">&nbsp;</span>
    <a href="#" class="btn close">关闭</a>
</div>

</fieldset>
</div><!-- id="id_myorder_1494663243" -->
